<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <title>Virtual Barbershop</title>
        <link rel="stylesheet" href="css/basic.css" type="text/css" />
        <link rel="stylesheet" href="css/galleriffic-5.css" type="text/css" />
        
        <link rel="stylesheet" href="css/black.css" type="text/css" />
        
        <script type="text/javascript" src="js/jquery-1.3.2.js"></script>
        <script type="text/javascript" src="js/jquery.history.js"></script>
        <script type="text/javascript" src="js/jquery.galleriffic.js"></script>
        <script type="text/javascript" src="js/jquery.opacityrollover.js"></script>
        <!-- We only want the thunbnails to display when javascript is disabled -->
        <script type="text/javascript">
            document.write('<style>.noscript { display: none; }</style>');
        </script>
    </head>
    <body>
        <div id="page">
            <div id="container">
                <h1>Virtual Barbershop</a></h1>

                <div>
                    <a href="#addImage" id="addImageLink">Insert Hairstyle 5</a>
                </div>

                <table border="0">
                    <tr>
                        <td>
                            <div>
                                <form name="mergeForm">
                                    x= <input type="text" name="x"><br>
                                    y= <input type="text" name="y"><br>
                                    angle= <input type="text" name="angle"><br>
                                    sx= <input type="text" name="sx"><br>
                                    sy= <input type="text" name="sy"><br>
                                </form>
                                <a href="#mergeHairstyle" id="mergeHairstyleLink">Merge Hairstyle</a>
                            </div>
                        </td>
                        <td><img id="merged"/></td>
                    </tr>
                </table>

                <!-- Start Advanced Gallery Html Containers -->                
                <div class="navigation-container">
                    <div id="thumbs" class="navigation">
                        <a class="pageLink prev" style="visibility: hidden;" href="#" title="Previous Page"></a>
                    
                        <ul class="thumbs noscript">
                            <li>
                                <a class="thumb" name="1" href="pictures/1.jpg" title="Hairstyle 1">
                                    <img src="pictures/1_s.jpg" alt="Hairstyle 1" />
                                </a>
                                <div class="caption">
                                    <div class="image-title">Hairstyle 1</div>
                                    <div class="image-desc">Made by barbershop1</div>
                                </div>
                            </li>
                            <li>
                                <a class="thumb" name="2" href="pictures/2.jpg" title="Hairstyle 2">
                                    <img src="pictures/2_s.jpg" alt="Hairstyle 2" />
                                </a>
                                <div class="caption">
                                    <div class="image-title">Hairstyle 2</div>
                                    <div class="image-desc">Made by barbershop2</div>
                                </div>
                            </li>
                            <li>
                                <a class="thumb" name="3" href="pictures/3.jpg" title="Hairstyle 3">
                                    <img src="pictures/3_s.jpg" alt="Hairstyle 3" />
                                </a>
                                <div class="caption">
                                    <div class="image-title">Hairstyle 3</div>
                                    <div class="image-desc">Made by barbershop2</div>
                                </div>
                            </li>
                            <li>
                                <a class="thumb" name="4" href="pictures/4.jpg" title="Hairstyle 4">
                                    <img src="pictures/4_s.jpg" alt="Hairstyle 4" />
                                </a>
                                <div class="caption">
                                    <div class="image-title">Hairstyle 4</div>
                                    <div class="image-desc">Made by barbershop1</div>
                                </div>
                            </li>
                        </ul>

                        <a class="pageLink next" style="visibility: hidden;" href="#" title="Next Page"></a>
                    </div>
                </div>
                <div class="content">
                    <div class="slideshow-container">
                        <div id="controls" class="controls"></div>
                        <div id="loading" class="loader"></div>
                        <div id="slideshow" class="slideshow"></div>
                    </div>
                    <div id="caption" class="caption-container">
                        <div class="photo-index"></div>
                    </div>
                </div>
                <!-- End Gallery Html Containers -->
                <div style="clear: both;"></div>
            </div>
        </div>
        <div id="footer">&copy; 2009 Trent Foley</div>
        <script type="text/javascript">
            jQuery(document).ready(function($) {
                // We only want these styles applied when javascript is enabled
                $('div.content').css('display', 'block');

                // Initially set opacity on thumbs and add
                // additional styling for hover effect on thumbs
                var onMouseOutOpacity = 0.67;
                $('#thumbs ul.thumbs li, div.navigation a.pageLink').opacityrollover({
                    mouseOutOpacity:   onMouseOutOpacity,
                    mouseOverOpacity:  1.0,
                    fadeSpeed:         'fast',
                    exemptionSelector: '.selected'
                });
                
                // Initialize Advanced Galleriffic Gallery
                var gallery = $('#thumbs').galleriffic({
                    delay:                     2500,
                    numThumbs:                 10,
                    preloadAhead:              10,
                    enableTopPager:            false,
                    enableBottomPager:         false,
                    imageContainerSel:         '#slideshow',
                    controlsContainerSel:      '#controls',
                    captionContainerSel:       '#caption',
                    loadingContainerSel:       '#loading',
                    renderSSControls:          true,
                    renderNavControls:         true,
                    playLinkText:              '',
                    pauseLinkText:             '',
                    prevLinkText:              '&lsaquo; Previous Hairstyle',
                    nextLinkText:              'Next Hairstyle &rsaquo;',
                    nextPageLinkText:          'Next &rsaquo;',
                    prevPageLinkText:          '&lsaquo; Prev',
                    enableHistory:             true,
                    autoStart:                 false,
                    syncTransitions:           true,
                    defaultTransitionDuration: 900,
                    onSlideChange:             function(prevIndex, nextIndex) {
                        // 'this' refers to the gallery, which is an extension of $('#thumbs')
                        this.find('ul.thumbs').children()
                            .eq(prevIndex).fadeTo('fast', onMouseOutOpacity).end()
                            .eq(nextIndex).fadeTo('fast', 1.0);

                        // Update the photo index display
                        this.$captionContainer.find('div.photo-index')
                            .html('Hairstyle '+ (nextIndex+1) +' of '+ this.data.length);
                    },
                    onPageTransitionOut:       function(callback) {
                        this.fadeTo('fast', 0.0, callback);
                    },
                    onPageTransitionIn:        function() {
                        var prevPageLink = this.find('a.prev').css('visibility', 'hidden');
                        var nextPageLink = this.find('a.next').css('visibility', 'hidden');
                        
                        // Show appropriate next / prev page links
                        if (this.displayedPage > 0)
                            prevPageLink.css('visibility', 'visible');

                        var lastPage = this.getNumPages() - 1;
                        if (this.displayedPage < lastPage)
                            nextPageLink.css('visibility', 'visible');

                        this.fadeTo('fast', 1.0);
                    },
                    onImageAdded:              function(imageData, $li) {
                        $li.opacityrollover({
                            mouseOutOpacity:   onMouseOutOpacity,
                            mouseOverOpacity:  1.0,
                            fadeSpeed:         'fast',
                            exemptionSelector: '.selected'
                        });

                         // Update the photo index display
                        this.$captionContainer.find('div.photo-index')
                            .html('Hairstyle '+ (this.currentImage.index+1) +' of '+ this.data.length);
                    }
                });

                /**************** Event handlers for custom next / prev page links **********************/

                gallery.find('a.prev').click(function(e) {
                    gallery.previousPage();
                    e.preventDefault();
                });

                gallery.find('a.next').click(function(e) {
                    gallery.nextPage();
                    e.preventDefault();
                });

                /****************************************************************************************/

                /**** Functions to support integration of galleriffic with the jquery.history plugin ****/

                // PageLoad function
                // This function is called when:
                // 1. after calling $.historyInit();
                // 2. after calling $.historyLoad();
                // 3. after pushing "Go Back" button of a browser
                function pageload(hash) {
                    // alert("pageload: " + hash);
                    // hash doesn't contain the first # character.
                    if(hash) {
                        $.galleriffic.gotoImage(hash);
                    } else {
                        gallery.gotoIndex(0);
                    }
                }

                // Initialize history plugin.
                // The callback is called at once by present location.hash. 
                $.historyInit(pageload, "advanced.html");

                // set onclick event for buttons using the jQuery 1.3 live method
                $("a[rel='history']").live('click', function(e) {
                    if (e.button != 0) return true;

                    var hash = this.href;
                    hash = hash.replace(/^.*#/, '');

                    // moves to a new page. 
                    // pageload is called at once. 
                    // hash don't contain "#", "?"
                    $.historyLoad(hash);

                    return false;
                });

                /****************************************************************************************/
                /********************** Attach click event to the Add Image Link ************************/

                $('#addImageLink').click(function(e) {
                    gallery.insertImage('<li>\
                            <a class="thumb" href="pictures/5.jpg" title="Dynamically Added Hairstyle 5">\
                                <img src="pictures/5_s.jpg" alt="Dynamically Added Hairstyle 5" />\
                            </a>\
                            <div class="caption">\
                                <div class="image-title">Dynamically Added Hairstyle 5</div>\
                                <div class="image-desc">by barbershop7</div>\
                            </div>\
                        </li>', 0);
                    
                    e.preventDefault();
                });

                /********************** Attach click event to the Merge Hairstyle Link ************************/
                $('#mergeHairstyleLink').click(function(e) {
                    var path = 'src/main/webapp/' + gallery.currentImage.href;
                    var resSrc = 'http://localhost:8088/vb?action=mergeImages&image1=man.png&image2=' + path;
                    resSrc = resSrc + '&x=' + (mergeForm.x.value == '' ? 135 : mergeForm.x.value);
                    resSrc = resSrc + '&y=' + (mergeForm.y.value == '' ? 178 : mergeForm.y.value);
                    resSrc = resSrc + '&angle=' + (mergeForm.angle.value == '' ? 0.3 : mergeForm.angle.value);
                    resSrc = resSrc + '&sx=' + (mergeForm.sx.value == '' ? 0.5 : mergeForm.sx.value);
                    resSrc = resSrc + '&sy=' + (mergeForm.sy.value == '' ? 0.5 : mergeForm.sy.value);

                    var img = document.getElementById('merged');
                    img.src =  resSrc;

                    /*var img = document.createElement('img');
                    img.src =  resSrc;
                    document.getElementById('mergeResult').appendChild(img);*/

                    e.preventDefault();
                });
            });
        </script>
    </body>
</html>
